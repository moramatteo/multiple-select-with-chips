function create_chips(e,t){for(var l="",n=0;n<t.length;n++)1==t[n].select&&(l+=`<div value="${t[n].value}">\n          <span>${t[n].text}</span>\n          <span class="delete-chip material-icons" value="${t[n].value}" select_name="${e}" onclick="${delete_chip_function}">close</span>\n        </div>`);return l}function create_options(e,t){for(var l="",n=0;n<t.length;n++)1==t[n].select?l+=`<div class="option select" value="${t[n].value}" select_name="${e}" onclick="${delete_chip_function}">`:l+=`<div class="option" value="${t[n].value}" select_name="${e}" onclick="${add_chip_function}">`,l+=`\n          <div class="option-text">${t[n].text}</div>\n          <div class="check-mark">\n            <span class="material-icons-outlined">close</span>\n          </div>\n        </div>`;return l}function select_constructor(e,t,l){l||(l={});try{null==l.placeholder&&(l.placeholder="Cerca"),data_validator(e,t,"constructor");var n=create_chips(e,t),s=`<div class="selected">\n      <div class="chips">\n        ${n}\n      </div>\n      <input type="text" class="text-input add_personal_chip" placeholder="${l.placeholder}" select_name="${e}"\n      onfocus="show_options_list($(this).attr('select_name'))" \n      onkeyup="options_filter($(this).attr('select_name'), this.value)"\n      onfocusout="focus_out($(this).attr('select_name'), this.value)">\n    </div>\n    <div class="options-list hide">\n      ${create_options(e,t)}\n    </div>`;$(`[select_name='${e}']`).append(s),0==l.add_personal_chip&&$(`[select_name='${e}'] .text-input`).removeClass("add_personal_chip"),0==l.autocomplete&&$(`[select_name='${e}'] .text-input`).removeAttr("onkeyup"),select_catalog[e]={},"number"==typeof l.max_selections&&(select_catalog[e].max_selections=l.max_selections),null!=l.onchange&&""!=l.onchange&&(select_catalog[e].onchange=l.onchange),null!=l.onkeyup&&""!=l.onkeyup&&(select_catalog[e].onkeyup=l.onkeyup),set_input_with()}catch(t){alert(`errore nel selettore chiamato "${e}"\n${t}`),$(`[select_name='${e}']`).append("errore nell'inserimento delle opzioni")}}function show_options_list(e){$(".options-list").addClass("hide"),$(`[select_name='${e}'] > .options-list`).removeClass("hide"),select_name=e}function add_chip(e,t,l,n){try{if(n||(n=select_name),check_limit(n),""!=e){var s=t[0].firstChild.nextSibling.innerText;$(e).addClass("select")}else{s=l;data_validator(n,s,"enter")}$(`[select_name='${n}'] .chips`).append(`\n    <div value="${l}">\n      <span>${s}</span>\n      <span class="delete-chip material-icons" value="${l}" select_name="${n}" onclick="${delete_chip_function}">close</span>\n    </div>\n  `),$(e).attr("onclick",`${delete_chip_function}`),$(`[select_name='${n}'] input`).val(""),set_input_with(),null!=select_catalog[n].onchange&&window[select_catalog[n].onchange](n,"add",l)}catch(e){alert(e)}}function focus_out(e,t){!0===mobile&&""!=t&&($(`[select_name="${e}"] .options-list`).addClass("hide"),add_chip("","",t,e))}function delete_chip(e,t){$(`[select_name='${t}'] .chips > div[value="${e}"]`).remove(),$(`[select_name='${t}'] .option[value="${e}"]`).removeClass("select").attr("onclick",add_chip_function),null!=select_catalog[t].onchange&&window[select_catalog[t].onchange](t,"remove",e),set_input_with()}function onKeyPressed(e){var t=e.key;if(("Enter"==t||"Tab"==t)&&1==$(`[select_name='${select_name}']  .text-input`).is(":focus")&&1==$(`[select_name='${select_name}']  .text-input`).hasClass("add_personal_chip")){var l=$(`.text-input[select_name='${select_name}']`).val();""!=l&&($(".text-input").val("").blur(),add_chip("","",l),$(`[select_name='${select_name}'] .option`).removeClass("hide"),$(`[select_name='${select_name}'] .options-list`).addClass("hide"))}}function options_filter(e,t){if(""==t)$(`[select_name='${select_name}'] .option`).removeClass("hide");else for(var l=$(`[select_name='${select_name}'] .options-list`).children().length,n=1;n<l+1;n++)-1==$(`[select_name='${select_name}'] .option:nth-child(${n}) > .option-text`).html().toLowerCase().indexOf(t.toLowerCase())?$(`[select_name='${select_name}'] .option:nth-child(${n})`).addClass("hide"):$(`[select_name='${select_name}'] .option:nth-child(${n})`).removeClass("hide");$(`[select_name='${select_name}'] .option`).removeClass("top-border bottom-border"),$(`[select_name='${select_name}'] .option:not(.hide)`).first().addClass("top-border"),$(`[select_name='${select_name}'] .option:not(.hide)`).last().addClass("bottom-border"),null!=select_catalog[e].onkeyup&&window[select_catalog[e].onkeyup](e,t)}function new_datas(e,t,l){l||(l="replace");try{data_validator(e,t,l);var n=create_chips(e,t),s=create_options(e,t);"replace"==l&&($(`[select_name='${e}'] .options-list`).replaceWith('<div class="options-list hide">'+s+"</div>"),$(`[select_name='${e}'] .chips`).empty().append(`${n}`)),"add"==l&&($(`[select_name='${e}'] .options-list`).append(s),$(`[select_name='${e}'] .chips`).append(`${n} `))}catch(t){alert(`errore nel selettore chiamato ${e}\n${t}`),$(`[select_name='${e}']`).replaceWith("errore nell'inserimento delle opzioni")}}function get_value(e){for(var t={all:check_all_selected(),names:[],values:[],added_values:[]},l=$(`[select_name='${e}'] .chips`).children().length,n=1;n<l+1;n++){var s=$(`[select_name='${e}'] .chips > div:nth-child(${n})`).attr("value");t.values.push(s);var a=$(`[select_name='${e}'] .chips > div:nth-child(${n}) > span:nth-child(2)`).html();t.names.push(a),0==$(`[select_name='${e}'] .options-list > div[value='${s}']`).length&&t.added_values.push(s)}return t}function check_all_selected(e){for(var t=!0,l=$(`[select_name='${e}'] .options-list`).children().length,n=1;n<l+1;n++){var s=`[select_name='${e}'] .options-list > div:nth-child(${n})`;if(0==$(s).hasClass("select")){t=!1;break}}return t}function select_all(e){e||(e=select_name);for(var t=$(`[select_name='${e}'] .options-list`).children().length,l=1;l<t+1;l++){var n=`[select_name='${e}'] .options-list > div:nth-child(${l})`;1!=$(n).hasClass("select")&&add_chip($(n),$(n).first(),$(n).attr("value"),e)}}function deselect_all(e,t){e||(e=select_name);for(var l=$(`[select_name='${e}'] .options-list`).children().length,n=1;n<l+1;n++){var s=`[select_name='${e}'] .options-list > div:nth-child(${n})`;0!=$(s).hasClass("select")&&($(s).removeClass("select"),delete_chip($(s).attr("value"),e))}"forced"==t&&$(`[select_name='${e}'] .chips`).empty()}function data_validator(e,t,l){var n=[];if("enter"==l){for(var s=$(`[select_name='${e}'] .chips`).children().length,a=1;a<s+1;a++){var i=`[select_name='${e}'] .chips > div:nth-child(${a})`,c=$(i).attr("value");if(n.push(c),n.includes(t))throw"valore già selezionato"}var o=$(`[select_name='${e}'] .options-list`).children().length;for(a=1;a<o+1;a++){i=`[select_name='${e}'] .options-list > div:nth-child(${a})`,c=$(i).attr("value");if(n.push(c),n.includes(t))throw"c'è già una opzione con questo valore"}}if("constructor"==l||"replace"==l)for(a=0;a<t.length;a++){if(null==t[a].text||""==t[a].text)throw`Non è stato impostato nessun testo per il valore "${t[a].value}"`;if(null==t[a].value||""==t[a].value)throw`Non è stato impostato nessun valore per il testo "${t[a].text}"`;if(n.includes(t[a].value))throw"Ci sono dei valori duplicati";n.push(t[a].value)}if("add"==l){data_validator(e,t,"replace");for(s=$(`[select_name='${e}'] .chips`).children().length,a=1;a<s+1;a++){i=`[select_name='${e}'] .chips > div:nth-child(${a})`,c=$(i).attr("value");n.push(c)}for(o=$(`[select_name='${e}'] .options-list`).children().length,a=1;a<o+1;a++){i=`[select_name='${e}'] .options-list > div:nth-child(${a})`,c=$(i).attr("value");n.push(c)}for(a=0;a<t.length;a++)if(n.includes(t[a].value))throw"Ci sono dei valori duplicati"}}function check_limit(e){var t=$(`[select_name='${this.select_name}'] .chips`).children().length,l=select_catalog[e].max_selections;if(t==l)throw"Limite di elementi selezionabili raggiunto"}function set_input_with(){for(var e=$("div.multiple-select-chip[select_name]").length,t=0;t<e;t++){var l=$(`div.multiple-select-chip[select_name]:eq(${t}) .chips`).width(),n=$(`div.multiple-select-chip[select_name]:eq(${t}) .selected`).width(),s=n-l;s>100?$(`div.multiple-select-chip[select_name]:eq(${t}) .text-input`).css("width",s):$(`div.multiple-select-chip[select_name]:eq(${t}) .text-input`).css("width","100px")}}var select_name,mobile,old_select_name,select_catalog={},delete_chip_function="delete_chip($(this).attr('value'), $(this).attr('select_name'))",add_chip_function="add_chip(this, $(this).first(), $(this).attr('value'))";mobile=!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),document.onclick=function(e){var t=!0,l=select_name;old_select_name!=l&&null!=old_select_name&&$(`[select_name="${old_select_name}"] .options-list`).addClass("hide");for(var n=0;n<e.path.length;n++)if(null!=e.path[n].className&&e.path[n].className.includes("multiple-select-chip")){t=!1,old_select_name=l;break}t&&$(`[select_name="${l}"] .options-list`).addClass("hide")},document.addEventListener("keydown",onKeyPressed);class select{constructor(e,t,l){this.select_name=e,select_constructor(this.select_name,t,l)}create_chips(e){create_chips(this.select_name,e)}create_options(e){create_options(this.select_name,e)}new_datas(e,t){new_datas(this.select_name,e,t)}get_value(){return get_value(this.select_name)}check_all_selected(){check_all_selected(this.select_name)}select_all(){select_all(this.select_name)}deselect_all(e){deselect_all(this.select_name,e)}}$(window).resize(function(){set_input_with()});